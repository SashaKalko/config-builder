<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <title>Config-Builder</title>

    <meta name="description" content="Alles in einer Klasse - Der TNG Config-Builder">
    <meta name="author" content="Matthias Bollwein, Thomas Endres, Andreas Würl">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css"/>
    <link rel="stylesheet" href="css/theme/tng.css" id="theme"/>
    <link rel="stylesheet" href="css/custom.css"/>
    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/github.css"/>
    <link rel="stylesheet" href="css/styles/github.css"/>

    <script data-main="js/main" src="js/vendor/require.js"></script>

    <script>
        if (window.location.search.match(/print-pdf/gi)) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = 'css/print/pdf.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        }
    </script>

</head>

<body class="charred auto-fragment">

<div class="i18n">
    <span class="section-overview">Overview</span>
</div>

<section>
    <img src="img/builder/tag-cloud.png" style="width: 1200px; box-shadow: none;"/>


    <p style="padding-top:2%">
        <a href="mailto:matthias.bollwein@tngtech.com">Matthias Bollwein</a>,
        <a href="mailto:thomas.endres@tngtech.com">Thomas Endres</a>,
        <a href="mailto:andreas.wuerl@tngtech.com">Andreas Würl</a><br/>
        Stuttgart, 17.07.2014
    </p>

    <p style="padding-top:2%">
        <a href="http://www.tngtech.com"><img class="logo" src="img/tng.svg" style="box-shadow: none;"></a>
    </p>
</section>

<section data-title="Motivation">
    <section>
        <h2>Our config class</h2>

        <pre><code class="java" data-noescape>public class Config
{
    §§private String characterName;§§

    §§private int difficulty;§§

    §§private Color playerColor;§§

    §§private Set&lt;Cheat&gt; activeCheats;§§

    §§private String language;§§

    §§private Path currentDirectory;§§

    §§// Setters and getters§§
}</code></pre>
    </section>

    <section>
        <h2>Typical architecture</h2>

        <pre><code class="java" data-noescape>    public Config loadConfig() {
        §§Config config = new Config();§§

        §§loadBaseConfig(config);§§
        §§overwriteWithProperties(config);§§

        §§// do other specific stuff§§

        §§return config;§§
    }</code></pre>
    </section>

    <section>
        <img src="img/builder/sysiphos.jpg" style="width: 400px;"/>
    </section>

    <section>
        <h2>How about this?</h2>

        <pre><code class="java" data-noescape>    public Config loadConfig() {
        return ConfigBuilder.on(Config.class).build();
    }</code></pre>
    </section>

    <section>
        <img src="img/builder/config-builder.jpg"/>
    </section>
</section>

    <section data-title="Getting started">

    <section>
        <h2>Intro</h2>
            <pre><code id="viewer-intro" class="viewer"
                       data-file="java/src/main/java/com/tngtech/test/intro/Config.java"
                       data-language="java" style="height: 350px;"
                       data-noescape></code></pre>

        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/intro/Config.java"></pre>
        </div>
    </section>

    <section>
        <h2>Basic tool box</h2>
        <img src="img/toolbox/toolbox.png" style="height: 350px;"/>
    </section>

    <section>
        <h2>Default values</h2>
        <img src="img/toolbox/screwdriver.png" style="height: 350px;"/>
    </section>

    <section class="only-in-print">
        <h2>Default values</h2>

        <pre><code class="java" data-noescape>public class Config
{
    ^^@DefaultValue("Player")^^
    private String characterName;

    ^^@DefaultVa lue("1")^^
    private int difficulty;

    // ...
}</code></pre>
    </section>

    <section class="not-printed">
        <h2>Default values</h2>
            <pre><code id="viewer-defaultvalue" class="viewer"
                       data-file="java/src/main/java/com/tngtech/test/defaultvalue/Config.java"
                       data-language="java" style="height: 350px;"
                       data-noescape></code></pre>

        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/defaultvalue/Config.java"></pre>
        </div>
    </section>

    <section>
        <h2>Command line values</h2>
        <img src="img/toolbox/hammer.png" style="height: 500px;"/>
    </section>

    <section class="only-in-print">
        <h2>Command line values</h2>

        <pre><code class="java" data-noescape>public class Config
{
    @DefaultValue("Player")
    ^^@CommandLineValue(shortOpt="c", longOpt="character-name", hasArg=true)^^
    private String characterName;

    @DefaultValue("1")
    ^^@CommandLineValue(shortOpt="d", longOpt="difficulty", hasArg=true)^^
    private int difficulty;

    // ...
}</code></pre>
    </section>

    <section class="not-printed">
        <h2>Command line values</h2>
                    <pre><code id="viewer-commandline" class="viewer"
                               data-file="java/execute-command-line.sh"
                               data-language="bash" style="height: 60px;"
                               data-noescape></code></pre>
        <pre><code id="viewer-commandlinevalue" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/commandlinevalue/Config.java"
                   data-language="java" style="height: 350px;"
                   data-noescape></code></pre>
        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/commandlinevalue/Config.java"></pre>
        </div>
    </section>

    <section>
        <h2>Property values</h2>
        <img src="img/toolbox/saw.png" style="height: 400px;"/>
    </section>

    <section class="only-in-print">
        <h2>Property values</h2>

        <pre><code class="java" data-noescape>^^@PropertiesFiles({"config", "test-config"})^^
public class Config
{
    // ...

    @DefaultValue("1")
    @CommandLineValue(shortOpt="d", longOpt="difficulty", hasArg=true)
    ^^@PropertyValue("difficulty")^^
    private int difficulty;

    ^^@PropertyValue("player.color")^^
    private int playerColor;

    // ...
}</code></pre>
    </section>
    <section class="not-printed">
        <h2>Property values</h2>
                    <pre><code id="viewer-propertyfile" class="viewer"
                               data-file="src/main/resources/config.properties"
                               data-language="properties" style="height: 60px;"
                               data-noescape></code></pre>
        <pre><code id="viewer-propertyvalue" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/propertyvalue/Config.java"
                   data-language="java" style="height: 350px;"
                   data-noescape></code></pre>
        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/propertyvalue/Config.java"></pre>
        </div>
    </section>
	
    <section>
        <h2>Env variables and<br/>system properties</h2>

        <img src="img/toolbox/wrench.png" style="height: 400px;"/>
    </section>

    <section class="only-in-print">
        <h2>Env vars/system properties</h2>

        <pre><code class="java" data-noescape>public class Config
{
    // ...

    ^^@SystemPropertyValue("user.language")^^
    private String language;

    ^^@EnvironmentVariableValue("PWD")^^
    private Path currentDirectory;

    // ...
}</code></pre>
    </section>
    <section class="not-printed">
        <h2>Env vars/system properties</h2>
        <pre><code id="viewer-envvars" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/envvars/Config.java"
                   data-language="java" style="height: 350px;"
                   data-noescape></code></pre>
        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/envvars/Config.java"></pre>
        </div>
    </section>

    <section>
        <h2>Type Conversion</h2>

        <img src="img/toolbox/conversion.png" style="width: 300px;"/>
    </section>

    <section>
        <h2>Our config class</h2>

        <pre><code class="java" data-noescape>public class Config
{
    // ...

    @PropertyValue("player.color")
    private ^^Color^^ playerColor;

    @PropertyValue("cheats.active")
    private ^^Set&lt;Cheat&gt;^^ activeCheats;

    @EnvironmentVariableValue("PWD")
    private ^^Path^^ currentDirectory;

    // Setters and getters
}</code></pre>
    </section>

    <section class="only-in-print">
        <h2>Transformer for Color</h2>

        <pre><code class="java" data-noescape>public class Config
{
    // ...

    @PropertyValue("player.color")
    ^^@TypeTransformers(StringToColorTransformer.class)^^
    private Color playerColor;

    // ...

    public static class ^^StringToColorTransformer^^
        extends TypeTransformer&lt;String, Color&gt; {

        @Override
        public Color transform(String colorText) {
            StyleSheet styleSheet = new StyleSheet();
            return styleSheet.stringToColor(colorText);
        }
    }
}</code></pre>
    </section>
    <section class="not-printed">
        <h2>Transformer for Color</h2>
        <pre><code id="viewer-colortransformer" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/colortransformer/Config.java"
                   data-language="java" style="height: 400px;"
                   data-noescape></code></pre>
        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/colortransformer/Config.java"></pre>
        </div>
    </section>

    <section class="only-in-print">
        <h2>Transformer for Set&lt;Cheat&gt;</h2>

        <pre><code class="java" data-noescape>public class Config
{

    @PropertyValue("cheats.active")
    ^^@TypeTransformers(StringToCheatTransformer.class)^^
    private Set&lt;Cheat&gt; cheats;

    // ...

    public static class ^^StringToCheatTransformer^^
        extends TypeTransformer&lt;String, Cheat&gt; {

        @Override
        public Cheat transform(String cheatText) {
            return Cheat.valueOf(cheatText);
        }
    }
}</code></pre>
    </section>
    <section class="not-printed">
        <h2>Transformer for Set&lt;Cheat&gt;</h2>
        <pre><code id="viewer-cheattransformer" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/cheattransformer/Config.java"
                   data-language="java" style="height: 350px;"
                   data-noescape></code></pre>
        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/cheattransformer/Config.java"></pre>
        </div>
    </section>

    <section>
        <h2>Tools so far</h2>

        <div class="animated-html" style="height: 600px;">
            <initial>
                <state data-id="toolbox-basic-features" data-property="opacity" data-value="0"></state>
            </initial>
            <animation data-duration="500">
                <animate data-id="toolbox-open" data-property="opacity" data-value="0"></animate>
                <animate data-id="toolbox-basic-features" data-property="opacity" data-value="1"></animate>
            </animation>

            <img id="toolbox-open" src="img/toolbox/toolbox-open.png" style="height: 400px;"/>

            <div id="toolbox-basic-features" style="margin-top: -400px;">
                <ul class="no-burn">
                    <li>Value sources
                        <ul class="no-burn">
                            <li>Default values</li>
                            <li>Properties files</li>
                            <li>System properties</li>
                            <li>Environment variables</li>

                        </ul>
                    </li>
                    <li style="padding-top: 10px;">Type transformers
                        <ul class="no-burn">
                            <li>Primitive/Collection (integrated)</li>
                            <li>Custom transformers</li>
                            <li>with transitive combination</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <section class="only-in-print">
        <h2>Final config class</h2>
        <pre><code class="java" data-noescape="" style="font-size: 60%; line-height: 120%;">@PropertiesFiles({"config", "test-config"})
public class Config
{
    @DefaultValue("Player")
    @CommandLineValue(shortOpt="c", longOpt="character-name", hasArg=true)
    private String characterName;

    @DefaultValue("1")
    @CommandLineValue(shortOpt="d", longOpt="difficulty", hasArg=true)
    @PropertyValue("difficulty")
    private int difficulty;

    @PropertyValue("player.color")
    @TypeTransformers(StringToColorTransformer.class)
    private Color playerColor;

    @PropertyValue("cheats.active")
    @TypeTransformers(StringToCheatTransformer.class)
    private Set&lt;Cheat&gt; activeCheats;

    @SystemPropertyValue("user.language")
    private String language;

    @EnvironmentVariableValue("PWD")
    private Path currentDirectory;

    public static class StringToColorTransformer extends TypeTransformer&lt;String, Color&gt; {
        @Override
        public Color transform(String colorText) {
            StyleSheet styleSheet = new StyleSheet();
            return styleSheet.stringToColor(colorText);
        }
    }

    public class StringToCheatTransformer extends TypeTransformer&lt;String, Cheat&gt; {
        @Override
        public Cheat transform(String cheatText) {
            return Cheat.valueOf(cheatText);
        }
    }

    // Setters and getters
}</code></pre>
    </section>

    <section class="only-in-print">
        <h2>Example main class</h2>
        <pre><code class="java" data-noescape="" style="line-height: 120%;">public class GameEntry {

    private Config config;

    public static void main(final String[] args) {

        config = ConfigBuilder.on(Config.class)
                              .withCommandLineArgs(args)
                              .build();

        // run game with config ...

    }
}</code></pre>
    </section>


    <section class="only-in-print">
        <h2>Results so far</h2>

        Contents of config.properties file:
        <pre><code>player.color = red
cheats.active = WALLHACK, GODMODE</code></pre>

        Command line input:
        <pre><code>&gt; cd /home/player/new_game
&gt; ./new-game -d 10 -c winner</code></pre>

        Resulting Config object:
        <pre><code>config = {
    characterName = "winner",
    difficulty = 10,
    playerColor = Color(255, 0, 0),
    activeCheats = {Cheat.WALLHACK, Cheat.GODMODE},
    language = "de",
    currentDirectory = Path("/home/player/new_game")
}</code></pre>
    </section>

</section>
<section data-title="Validation">

    <section>
        <h2>Validation</h2>
        <img src="img/toolbox/multimeter.png" style="height: 500px;"/>
    </section>
    <section>
        <h3>JSR303</h3>
	        <pre><code class="java" data-noescape>public class Config
{
    // ...

    ^^@Size(min = 2, max = 14)^^
    @DefaultValue("Player")
    @CommandLineValue(shortOpt="c", longOpt="character-name", hasArg=true)
    private String characterName;

    ^^@NotNull^^
    @EnvironmentVariableValue("PWD")
    private Path currentDirectory;

    // Setters and getters
}</code></pre>
    </section>
    <section>
        <h3>Validate method</h3>
	        <pre><code class="java" data-noescape>public class Config
{
    // ...

    @Size(min = 2, max = 14)
    @DefaultValue("Player")
    @CommandLineValue(shortOpt="c", longOpt="character-name", hasArg=true)
    private String characterName;

    @NotNull
    @EnvironmentVariableValue("PWD")
    private Path currentDirectory;

    ^^@Validation^^
    private void validate() {
        //Do whatever we want...
    }

    // Setters and getters
}</code></pre>
    </section>

</section>
<section data-title="Property-Loader">
    <section>
        <h2>Property-Loader</h2>
        <img src="img/toolbox/sawblade.png" style="height: 400px;"/>
    </section>
    <section>
        <h3>File Names, Suffixes &amp; Extensions</h3>
		 <pre><code class="java" data-noescape>^^@PropertiesFiles({"config", "test-config"})^^
^^@PropertySuffixes(extraSuffixes = {"tngtech","myname"}, hostNames = true)^^
^^@PropertyExtension("fileextension")^^
public class Config {

    @PropertyValue("cheats.active")
    @TypeTransformers(StringToCheatTransformer.class)
    private Set&lt;Cheat&gt; cheats;

    // ...
}</code></pre>
    </section>
    <section>
        <h3>Locations</h3>
		 <pre><code class="java" data-noescape>^^@PropertyLocations(directories = {"/home/user"}, contextClassLoader = true)^^
@PropertiesFiles({"config", "test-config"})
public class Config {

    @PropertyValue("cheats.active")
    @TypeTransformers(StringToCheatTransformer.class)
    private Set&lt;Cheat&gt; cheats;

    // ...
}</code></pre>
    </section>
    <section>
        <h2>Property Loader Overview</h2>

        <div class="animated-html" style="height: 600px;">
            <initial>
                <state data-id="toolbox-basic-features" data-property="opacity" data-value="0"></state>
            </initial>
            <animation data-duration="500">
                <animate data-id="toolbox-open" data-property="opacity" data-value="0"></animate>
                <animate data-id="toolbox-basic-features" data-property="opacity" data-value="1"></animate>
            </animation>

            <img id="toolbox-open" src="img/toolbox/toolbox-open.png" style="height: 400px;"/>

            <div id="toolbox-basic-features" style="margin-top: -400px;">
                <ul class="no-burn">
					<li>List of file basenames</li>
					<li style="padding-top: 10px;">File extension</li>
                    <li style="padding-top: 10px;">Suffixes
                        <ul class="no-burn">
                            <li>User name</li>
                            <li>Local host name</li>
                            <li>"override"</li>
                            <li>Custom extra suffixes</li>

                        </ul>
                    </li>
                    <li style="padding-top: 10px;">Search locations</li>
                        <ul class="no-burn">
                            <li>Classpath</li>
                            <li>Home directory</li>
							<li>Custom directories</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>


    </section>
</section>
<section data-title="Extensions">

    <section>
        <h2>Custom tools</h2>
        <img src="img/toolbox/custom-tool.png"/>
    </section>

    <section>
        <h3>Value source extension &ndash; File content value</h3>
        <ul>
		<li>Custom Annotation
			 <pre><code class="java" data-noescape style="width: 840px;">@ValueExtractorAnnotation(DefaultValueProcessor.class)
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface FileContentValue {
    String value();
    String encoding() default "UTF-8";
}</code></pre>
            </li>
	<li>Annotation Processor
			 <pre><code class="java" data-noescape style="width: 840px;">public class DefaultValueProcessor implements ValueExtractorProcessor {
    public String getValue(Annotation ann,
                           ConfigBuilderFactory configBuilderFactory) {
        try {
            FileContentValue fileContentValue = (FileContentValue) ann;
            byte[] content = Files.readAllBytes(
                 Paths.get(fileContentValue.value()));
            return new String(content, fileContentValue.encoding());
        } catch(IOException e) { e.printStackTrace(); }
    }
}</code></pre></li>
            </ul>
    </section>
	<section>
        <h3>Custom Annotation Example</h3>
			 <pre><code class="java" data-noescape>public class Config {

    ^^@FileContentValue("/home/user/help.txt", encoding="ISO-8859-1")^^
    private String helptext;

    // ...
}</code></pre>
	</section>
</section>

<section>

    <section>
        <h2>How to use ConfigBuilder?</h2>

        <p>Just add the Dependency!</p>

        <p>For example with Maven:</p>

        <pre style="width: 550px;"><code>&lt;dependency&gt;
    &lt;groupId&gt;com.tngtech.java&lt;/groupId&gt;
    &lt;artifactId&gt;config-builder&lt;/artifactId&gt;
    &lt;version&gt;1.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
    </section>

    <section>
        <h2>Requirements</h2>

        <ul class="no-burn">
            <li>Java 7</li>
            <li>Java 6 support is planned</li>
            <li style="padding-top: 10px;">
                Libraries used:
                <ul class="no-burn">
                    <li>Property Loader</li>
                    <li>Google Reflections</li>
                    <li>Logging Abstraction via SLF4J</li>
                    <li>Commons CLI</li>
                </ul>
            </li>
        </ul>
    </section>

    <section>
        <h2>Can I add features?</h2>

        <p>ConfigBuilder and PropertyLoader are open source licensed under Apache 2.0</p>

        <p>Feel free to fork them on GitHub</p>
        <ul class="no-burn">
            <li>https://github.com/TNG/config-builder</li>
            <li>https://github.com/TNG/property-loader</li>
        </ul>
    </section>
</section>

<!--<section>
    <section>
        <h2>Default Value</h2>
        <pre><code id="viewer-1" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/example1/Config.java"
                   data-language="java" style="height: 350px;"
                   data-noescape></code></pre>

        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/example1/Config.java"></pre>
        </div>
    </section>

    <section>
        <h2>Property Value</h2>
        <pre><code id="editor-2" class="viewer"
                   data-file="java/src/main/java/com/tngtech/test/example2/Config.java"
                   data-language="java" style="height: 400px;"
                   data-noescape></code></pre>

        <div class="output-section">
            <p>Output:</p>
            <pre class="output" data-file="java/src/main/java/com/tngtech/test/example2/Config.java"></pre>
        </div>
    </section>

</section>-->

<section>

    <section>
        <div>
            <img style="height: 200px" src="img/team/MatthiasBollwein.jpg">
            <img style="height: 200px" src="img/team/ThomasEndres.jpg">
            <img style="height: 200px" src="img/team/AndreasWuerl.jpg">
        </div>
        <p style="margin-top: 20px; margin-bottom: 20px;">
            <a href="https://github.com/TNG/config-builder">https://github.com/TNG/config-builder</a><br>
            <a href="http://www.tngtech.com">http://www.tngtech.com</a><br>
        </p>
        <a href="http://www.tngtech.com"><img class="logo" src="img/tng.svg"></a>
    </section>

    <section>
        <h2>Special thanks</h2>

        <ul class="no-burn">
            <li>Various TNG employees for creating the property loader</li>
            <li>http://openclipart.org for providing Public Domain pictures</li>
            <li>Jeremy Chapman for the multimeter image</li>
        </ul>
    </section>

</section>

</body>
</html>